<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>attempt at CodeMirror + in-place MathJax</title>
    <script src="CodeMirror/lib/codemirror.js"></script>
    <script src="CodeMirror/mode/markdown/markdown.js"></script>

    <script src="render-math.js"></script>

    <link rel="stylesheet" href="CodeMirror/lib/codemirror.css">
    <style type="text/css">
      .CodeMirror { border: 1px solid silver; border-width: 1px 2px; }
      .CodeMirror { font-family: sans-serif; }
      .cm-header { font-size: 150%; line-height: 200%; }

      /* Work around cursor/selection mispositioning introduced in
         CM commit de92ca1bab49a2f18bd6f7e9d8200a9d75270304 */
      .CodeMirror-widget { display: inline-block; }

      /* .MathJax-Display has built-in vertical margin: 1em.
         Inline math has nothing but this looks too dense.

         TODO: syntax highlight $...$ and style with same padding,
         otherwise this creates vetical jitter.  (High formulas cause
         this jitter anyway, but MathJax makes an effort for simple
         formulas to fit in a normal line.) */
      /* .MathJax { padding-top: 10%; padding-bottom: 10%; } */
    </style>

    <script src="https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"] ],
          displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
          processEscapes: true
        },
      });
    </script>

    <!-- I'm a JS noob, so jQuery increases my chance to write somewhat portable code ;-).
         Drop ".min" to get non-minified source for debugging. -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  </head>
  <body>
    <h1>attempt at CodeMirror + in-place MathJax</h1>

    <form><textarea id="code" name="code"># A First Level Header
xXxXxXxXxXxXxXxXxXxXxXxX
**Bold** and *italic* text in a normal line that is long enough to wrap, long enough to wrap, long enough to wrap, long enough to wrap.
xXxXxXxXxXxXxXxXxXxXxXxX
Normal-size line with $n$ compact formulas: $\sin x$.
xXxXxXxXxXxXxXxXxXxXxXxX
Foo $\sum^y_z \frac{1}{x}$ bar.
xXxXxXxXxXxXxXxXxXxXxXxX
## A Second Level Header
xXxXxXxXxXxXxXxXxXxXxXxX
$$\sum^b_c \frac{1}{a}$$
xXxXxXxXxXxXxXxXxXxXxXxX
</textarea></form>
    <script>
      var editor = CodeMirror.fromTextArea(document.getElementById("code"),
					   {lineNumbers: true,
					    lineWrapping: true,
					    mode: {name: "markdown",
						   underscoresBreakWords: false}});
      CodeMirror.renderMath(editor, MathJax, jQuery);
    </script>
  </body>
</html>
